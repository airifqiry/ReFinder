<!DOCTYPE html>
{% load static %}
<html lang="bg">
<head>
  <meta charset="UTF-8">
  <title>–ß–∞—Ç ‚Äì ReFinder</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .chat-bubble {
      max-width: 70%;
    }
  </style>
</head>
<body class="bg-[#213A58] text-white min-h-screen flex flex-col">

  <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è / –ó–∞–≥–ª–∞–≤–∏–µ -->
  <header class="bg-[#0C6478] p-4 shadow-md flex justify-between items-center">
    <h1 class="text-2xl font-bold text-[#80EE98]">üí¨ –ß–∞—Ç —Å {{ other_user.username }}</h1>
    <a href="{% url 'chat_list' %}" class="text-sm text-white hover:text-[#80EE98]">‚Üê –ù–∞–∑–∞–¥</a>
  </header>

  <!-- –°—ä–æ–±—â–µ–Ω–∏—è -->
  <div id="chat-box" class="flex-1 overflow-y-auto px-6 py-4 space-y-4 bg-[#1b2c48]">

    {% for msg in messages %}
      <div class="flex {% if msg.sender == request.user %}justify-end{% else %}justify-start{% endif %}">
        <div class="chat-bubble px-4 py-2 rounded-2xl shadow
          {% if msg.sender == request.user %}
            bg-[#80EE98] text-[#213A58] rounded-br-none
          {% else %}
            bg-[#0C6478] text-white rounded-bl-none
          {% endif %}
        ">
          <p class="text-sm break-words">{{ msg.text }}</p>
          <p class="text-xs mt-1 text-right text-gray-300">{{ msg.timestamp|date:"H:i d.m.Y" }}</p>
        </div>
      </div>
    {% empty %}
      <p class="text-center text-gray-400">–ù—è–º–∞ —Å—ä–æ–±—â–µ–Ω–∏—è.</p>
    {% endfor %}

  </div>

  <!-- –§–æ—Ä–º–∞ –∑–∞ —Å—ä–æ–±—â–µ–Ω–∏–µ -->
  <form method="POST" action="{% url 'send_message' chat.id %}" class="p-4 bg-[#0C6478] flex gap-2">
    {% csrf_token %}
    <input type="text" name="text" placeholder="–ù–∞–ø–∏—à–∏ —Å—ä–æ–±—â–µ–Ω–∏–µ..." required
           class="flex-1 px-4 py-2 rounded-xl text-[#213A58] focus:outline-none focus:ring-2 focus:ring-[#80EE98]">
    <button type="submit"
            class="bg-[#80EE98] px-4 py-2 rounded-xl text-[#213A58] font-bold hover:bg-[#46DFB1] transition">
      üì§
    </button>
  </form>

  <!-- –ê–≤—Ç–æ—Å–∫—Ä–æ–ª –¥–æ –¥—ä–Ω–æ—Ç–æ -->
  <script>
    const chatBox = document.getElementById("chat-box");
    chatBox.scrollTop = chatBox.scrollHeight;
  </script>

</body>
</html>
