<!DOCTYPE html>
{% load static %}
<html lang="bg">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–†–µ–¥–∞–∫—Ç–∏—Ä–∞–Ω–µ –Ω–∞ –æ–±—è–≤–∞</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- –î–æ–±–∞–≤—è–º–µ Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="{% static 'listing.css' %}">
  <style>
   #map { 
        height: 300px !important; 
        width: 100% !important; 
        margin-top: 10px; 
        border-radius: 12px;
        border: 2px solid red;
    }
    
  </style>
</head>
<body class="min-h-screen flex items-center justify-center p-6">
  
  {% if messages %}
    {% for message in messages %}
      <div class="bg-[#80EE98] text-[#213A58] p-4 rounded-xl text-center font-bold shadow-lg mb-6">
        {{ message }}
      </div>
    {% endfor %}
  {% endif %}

  <form id="adForm" method="POST" enctype="multipart/form-data" class="backdrop-blur-md bg-[#0C6478]/80 p-8 rounded-2xl shadow-2xl w-full max-w-2xl space-y-6 text-white">
    {% csrf_token %}

    <h2 class="text-3xl font-bold text-center text-[#80EE98] drop-shadow">–†–µ–¥–∞–∫—Ç–∏—Ä–∞–Ω–µ –Ω–∞ –æ–±—è–≤–∞</h2>

    <!-- –°–Ω–∏–º–∫–∞ -->
    <div>
      <label class="block mb-1 text-[#46DFB1] font-semibold">–°–Ω–∏–º–∫–∞</label>
      <input type="file" name="image" accept="image/*" class="w-full p-3 rounded-xl bg-[#15919B] text-white file:bg-[#213A58] file:text-white file:border-0 file:py-1 file:px-3">
    </div>
   

    <!-- –ó–∞–≥–ª–∞–≤–∏–µ -->
    <div>
      <label class="block mb-1 text-[#46DFB1] font-semibold">–ó–∞–≥–ª–∞–≤–∏–µ</label>
      <input type="text" name="title" required maxlength="100"
             class="w-full p-3 rounded-xl bg-[#15919B] text-white placeholder-white focus:outline-none focus:ring-2 focus:ring-[#80EE98]"
             placeholder="–ù–∞–ø–∏—à–∏ –∑–∞–≥–ª–∞–≤–∏–µ">
    </div>

    <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
    <div>
      <label class="block mb-1 text-[#46DFB1] font-semibold">–û–ø–∏—Å–∞–Ω–∏–µ (–¥–æ 50 –¥—É–º–∏)</label>
      <textarea name="description" required maxlength="300"
                oninput="countWords(this)"
                class="w-full p-3 rounded-xl bg-[#15919B] text-white placeholder-white focus:outline-none focus:ring-2 focus:ring-[#80EE98]"
                placeholder="–í—ä–≤–µ–¥–∏ –∫—Ä–∞—Ç–∫–æ –æ–ø–∏—Å–∞–Ω–∏–µ..."></textarea>
      <p id="wordCount" class="text-sm text-right mt-1 text-[#80EE98]">0/50 –¥—É–º–∏</p>
    </div>

    <!-- –°—Ç–∞—Ç—É—Å -->
    <div>
      <label class="block mb-1 text-[#46DFB1] font-semibold">–°—Ç–∞—Ç—É—Å</label>
      <select name="status" required class="w-full p-3 rounded-xl bg-[#15919B] text-white focus:outline-none">
        <option value="" disabled selected>–ò–∑–±–µ—Ä–∏ —Å—Ç–∞—Ç—É—Å</option>
        <option value="lost">–ò–∑–≥—É–±–µ–Ω–æ</option>
        <option value="found">–ù–∞–º–µ—Ä–µ–Ω–æ</option>
      </select>
    </div>

    <!-- –õ–æ–∫–∞—Ü–∏—è -->
    <div>
      <label class="block mb-1 text-[#46DFB1] font-semibold">–õ–æ–∫–∞—Ü–∏—è</label>
      <div class="flex gap-2">
        <input type="text" name="location" id="locationField" placeholder="–í—ä–≤–µ–¥–∏ –ª–æ–∫–∞—Ü–∏—è –∏–ª–∏ –∏–∑–±–µ—Ä–∏ –æ—Ç –∫–∞—Ä—Ç–∞—Ç–∞"
               class="w-full p-3 rounded-xl bg-[#15919B] text-white focus:outline-none">
        <button type="button" onclick="fillLocation()"
                class="bg-[#80EE98] text-[#213A58] font-bold px-4 rounded-xl hover:bg-[#46DFB1] transition-all">
          üìç
        </button>
      </div>
      <!-- –î–æ–±–∞–≤—è–º–µ –∫–∞—Ä—Ç–∞—Ç–∞ -->
      <div id="map" class="mt-4"></div>
    </div>

    <input type="hidden" name="latitude" id="id_latitude">
    <input type="hidden" name="longitude" id="id_longitude">

    <!-- –ë—É—Ç–æ–Ω -->
    <div class="text-center">
      <button type="submit"
              class="bg-[#80EE98] text-[#213A58] font-bold px-8 py-3 rounded-xl hover:bg-[#46DFB1] transition-all shadow-lg">
        –ó–∞–ø–∞–∑–∏ –ø—Ä–æ–º–µ–Ω–∏—Ç–µ
      </button>
    </div>
  </form>

  <!-- –î–æ–±–∞–≤—è–º–µ Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="{% static 'listing.js' %}"></script>
  <script>
    // –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–µ–¥–∏ –∏–∑–ø—Ä–∞—â–∞–Ω–µ –Ω–∞ —Ñ–æ—Ä–º–∞—Ç–∞
    document.getElementById('adForm').addEventListener('submit', function(e) {
      const lat = document.getElementById('id_latitude').value;
      const lng = document.getElementById('id_longitude').value;
      if (!lat || !lng) {
        e.preventDefault();
        alert('–ú–æ–ª—è, –∏–∑–±–µ—Ä–µ—Ç–µ –º—è—Å—Ç–æ –Ω–∞ –∫–∞—Ä—Ç–∞—Ç–∞ –∏–ª–∏ –∏–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ.');
      }
    });
  </script>
</body>
</html>